<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CinemaAdmin - Chỉnh sửa Combo Food</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />

    <style>
        body {
            font-family: "Inter", sans-serif;
            background-color: #f8fafc;
            color: #334155;
        }
        .form-section {
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.07);
            margin-bottom: 1.5rem;
            padding: 2rem 2.5rem;
        }
        .form-section .card-header {
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%) !important;
            color: white;
        }
        .upload-area {
            border: 2px dashed #e2e8f0;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.2s ease;
            background-color: #f8fafc;
        }
        .upload-area:hover,
        .upload-area.dragover {
            border-color: #6366f1;
            background-color: #f0f9ff;
        }
        .upload-area .fa-cloud-upload-alt {
            color: #94a3b8;
            margin-bottom: 0.5rem;
        }
        .upload-area h6 {
            font-weight: 600;
            color: #334155;
            margin-bottom: 0.25rem;
        }
        .upload-area p {
            font-size: 0.875rem;
            color: #64748b;
        }
        .upload-area p .text-primary {
            color: #6366f1 !important;
            font-weight: 500;
        }
        .upload-area small {
            font-size: 0.75rem;
            color: #94a3b8;
        }
        #imagePreview img {
            max-width: 100%;
            max-height: 200px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
        }
        #removeImageBtn {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
        .form-label.fw-semibold {
            color: #334155;
            margin-bottom: 0.5rem;
        }
        .form-label.required-error {
            color: #ef4444 !important;
            font-weight: 600;
        }
        .form-control,
        .form-select {
            border-radius: 0.375rem;
            border-color: #cbd5e1;
        }
        .form-control:focus,
        .form-select:focus {
            border-color: #6366f1;
            box-shadow: 0 0 0 0.25rem rgba(99, 102, 241, 0.25);
        }
        .input-group-text {
            background-color: #f1f5f9;
            border-color: #cbd5e1;
            color: #64748b;
        }
        .form-actions {
            padding-top: 1.5rem;
            margin-top: 1.5rem;
            border-top: 1px solid #e2e8f0;
        }
        .form-actions .btn {
            min-width: 120px;
            font-weight: 500;
        }
        .btn-primary {
            background-color: #6366f1;
            border-color: #6366f1;
        }
        .btn-primary:hover {
            background-color: #4f46e5;
            border-color: #4f46e5;
        }
        .btn-outline-danger {
            color: #ef4444;
            border-color: #ef4444;
        }
        .btn-outline-danger:hover {
            color: white;
            background-color: #ef4444;
            border-color: #ef4444;
        }
        .btn-outline-secondary {
            color: #64748b;
            border-color: #cbd5e1;
        }
        .btn-outline-secondary:hover {
            background-color: #f1f5f9;
            color: #475569;
            border-color: #cbd5e1;
        }
        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: width 0.3s ease;
            z-index: 1000;
        }
        .sidebar.collapsed {
            width: 80px;
        }
        .sidebar.collapsed .sidebar-header h5,
        .sidebar.collapsed .sidebar-header small,
        .sidebar.collapsed .sidebar-menu span,
        .sidebar.collapsed .mt-auto .text-white,
        .sidebar.collapsed .mt-auto small {
            display: none;
        }
        .sidebar.collapsed .sidebar-menu .menu-item {
            justify-content: center;
        }
        .sidebar.collapsed .sidebar-header .bg-white.rounded-circle.p-2.me-3 {
            margin-right: 0 !important;
        }
        .sidebar.collapsed .mt-auto img.rounded-circle.me-3 {
            margin-right: 0 !important;
        }
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .sidebar-header .fa-hamburger {
            color: #6366f1;
        }
        .sidebar-menu {
            flex-grow: 1;
            padding-top: 1rem;
        }
        .menu-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        .menu-item:hover,
        .menu-item.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border-left: 3px solid white;
            padding-left: calc(1.5rem - 3px);
        }
        .sidebar.collapsed .menu-item:hover,
        .sidebar.collapsed .menu-item.active {
            border-left: none;
            padding-left: 1.5rem;
        }
        .sidebar.collapsed .menu-item.active {
            background-color: #4f46e5;
        }
        .menu-item i {
            width: 20px;
            margin-right: 0.75rem;
            text-align: center;
        }
        .sidebar.collapsed .menu-item i {
            margin-right: 0;
            font-size: 1.25rem;
        }
        .main-content-wrapper {
            margin-left: 260px;
            transition: margin-left 0.3s ease;
            padding-top: 70px;
        }
        .main-content-wrapper.expanded {
            margin-left: 80px;
        }
        .header-custom {
            position: fixed;
            top: 0;
            left: 260px;
            right: 0;
            height: 70px;
            background-color: white;
            border-bottom: 1px solid #e5e7eb;
            z-index: 999;
            transition: left 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1.5rem;
        }
        .main-content-wrapper.expanded .header-custom {
            left: 80px;
        }
        @media (max-width: 768px) {
            .sidebar {
                width: 80px;
            }
            .sidebar .sidebar-header h5,
            .sidebar .sidebar-header small,
            .sidebar .sidebar-menu span,
            .sidebar .mt-auto .text-white,
            .sidebar .mt-auto small {
                display: none;
            }
            .sidebar .sidebar-menu .menu-item {
                justify-content: center;
            }
            .sidebar .sidebar-menu .menu-item i {
                margin-right: 0;
                font-size: 1.25rem;
            }
            .main-content-wrapper {
                margin-left: 80px;
            }
            .header-custom {
                left: 80px;
                padding: 0 1rem;
            }
            .header-custom .flex-grow-1 {
                display: none;
            }
        }
        @media (max-width: 768px) {
            .form-section { padding: 1rem; }
        }
    </style>
</head>
<body>
<div class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <div class="d-flex align-items-center">
            <div class="bg-white rounded-circle p-2 me-3">
                <i class="fas fa-hamburger"></i>
            </div>
            <div>
                <h5 class="text-white mb-0 fw-bold">CinemaAdmin</h5>
                <small class="text-white-50">Quản lý Combo Food</small>
            </div>
        </div>
    </div>
    <!-- Sidebar content -->
    <div th:replace="~{fragments/sidebar :: sidebar}"></div>

</div>
<div class="main-content-wrapper" id="mainContentWrapper">
    <header class="header-custom shadow-sm">
        <div class="d-flex align-items-center">
            <button class="btn btn-link text-secondary me-2" id="sidebarToggle">
                <i class="fas fa-bars fs-5"></i>
            </button>
            <h4 class="mb-0 fw-semibold text-gray-700" id="main-header-title">Chỉnh sửa Combo Food</h4>
        </div>
        <div class="d-flex align-items-center">
            <button class="btn btn-link text-secondary me-1 position-relative">
                <i class="fas fa-bell fs-5"></i>
                <span class="position-absolute top-0 start-100 translate-middle p-1 bg-danger border border-light rounded-circle" style="font-size: 0.5rem; width:10px; height:10px; display:flex; align-items:center; justify-content:center;">
                    <span class="visually-hidden">Thông báo mới</span>
                </span>
            </button>
            <button class="btn btn-link text-secondary me-2">
                <i class="fas fa-cog fs-5"></i>
            </button>
            <div class="dropdown">
                <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle" id="dropdownUser" data-bs-toggle="dropdown" aria-expanded="false">
                    <img src="https://via.placeholder.com/32" alt="User Avatar" width="32" height="32" class="rounded-circle me-2">
                    <span class="d-none d-sm-inline text-gray-700 fw-medium">Admin User</span>
                </a>
                <ul class="dropdown-menu dropdown-menu-end text-small shadow border-0" aria-labelledby="dropdownUser">
                    <li><a class="dropdown-item" href="/profile"><i class="fas fa-user-circle me-2 text-muted"></i>Hồ sơ</a></li>
                    <li><a class="dropdown-item" href="#"><i class="fas fa-sliders-h me-2 text-muted"></i>Cài đặt</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item text-danger" href="redirect:/admin/login"><i class="fas fa-sign-out-alt me-2"></i>Đăng xuất</a></li>
                </ul>
            </div>
        </div>
    </header>
    <div class="container-fluid p-4">
        <div id="editFoodFormView" class="container py-4">
            <form id="foodForm" th:action="@{'/admin/foods/edit/' + ${food.id}}" method="post" enctype="multipart/form-data" th:object="${food}" onsubmit="return validateFoodForm()">
                <div class="row">
                    <div class="col-12">
                        <div class="form-section">
                            <div class="card-header p-3">
                                <h5 class="mb-0 fw-semibold">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Chỉnh sửa Combo Food
                                </h5>
                            </div>
                            <div class="card-body p-3 p-md-4">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label fw-semibold" for="name">Tên combo *</label>
                                        <input type="text" class="form-control" id="name" name="name" placeholder="Nhập tên combo" th:field="*{name}" required />
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label class="form-label fw-semibold" for="price">Giá *</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-money-bill"></i></span>
                                            <input type="number" step="0.01" class="form-control" id="price" name="price" placeholder="0.00" th:field="*{price}" required />
                                        </div>
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label class="form-label fw-semibold" for="size">Số lượng *</label>
                                        <input type="number" class="form-control" id="size" name="size" placeholder="Nhập số lượng" th:field="*{size}" required />
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-semibold" for="description">Mô tả</label>
                                    <textarea class="form-control" id="description" name="description" rows="3" placeholder="Nhập mô tả combo" th:field="*{description}"></textarea>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label fw-semibold" for="imageFile">Hình ảnh *</label>
                                    <div class="mb-2">
                                        <span>Hình ảnh hiện tại:</span><br>
                                        <img th:src="@{${food.image}}" alt="Food Image" class="img-thumbnail" style="max-width:120px; max-height:120px;">
                                    </div>
                                    <div class="upload-area" id="uploadArea">
                                        <i class="fas fa-cloud-upload-alt fa-2x"></i>
                                        <h6>Kéo & Thả hình ảnh mới vào đây (nếu muốn thay đổi)</h6>
                                        <p class="mb-1">hoặc <span class="text-primary">chọn tệp</span></p>
                                        <small>PNG, JPG tối đa 5MB. Đề xuất: 300x300px</small>
                                        <input type="file" id="imageFile" name="imageFile" class="d-none" accept="image/png, image/jpeg" />
                                    </div>
                                    <div id="imagePreview" class="mt-3 d-none text-center position-relative" style="max-width: 200px; margin-left: auto; margin-right: auto;">
                                        <img id="previewImg" class="img-fluid rounded" alt="Xem trước hình ảnh" />
                                        <button type="button" id="removeImageBtn" class="btn btn-danger btn-sm position-absolute top-0 end-0 m-1 d-none" title="Xóa ảnh">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="d-flex justify-content-end align-items-center form-actions">
                    <a th:href="@{/admin/foods/list}" class="btn btn-outline-danger me-2">
                        <i class="fas fa-times me-2"></i>Hủy
                    </a>
                    <button type="submit" class="btn btn-primary" id="submitBtn">
                        <i class="fas fa-save me-2"></i>Lưu thay đổi
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        initializeDashboardBehavior();
        initializeFileUpload();
    });
    function initializeDashboardBehavior() {
        const sidebarToggle = document.getElementById("sidebarToggle");
        const sidebar = document.getElementById("sidebar");
        const mainContentWrapper = document.getElementById("mainContentWrapper");
        if (!sidebarToggle || !sidebar || !mainContentWrapper) return;
        function toggleSidebar() {
            sidebar.classList.toggle("collapsed");
            mainContentWrapper.classList.toggle("expanded");
        }
        sidebarToggle.addEventListener("click", toggleSidebar);
        function checkViewport() {
            if (window.innerWidth <= 992) {
                if (!sidebar.classList.contains("collapsed")) {
                    toggleSidebar();
                }
            }
        }
        checkViewport();
        window.addEventListener("resize", checkViewport);
    }
    function initializeFileUpload() {
        const uploadArea = document.getElementById("uploadArea");
        const fileInput = document.getElementById("imageFile");
        const imagePreview = document.getElementById("imagePreview");
        const previewImg = document.getElementById("previewImg");
        const removeImageBtn = document.getElementById("removeImageBtn");
        if (!uploadArea || !fileInput || !imagePreview || !previewImg || !removeImageBtn) return;
        uploadArea.addEventListener("click", () => fileInput.click());
        uploadArea.addEventListener("dragover", (e) => {
            e.preventDefault();
            uploadArea.classList.add("dragover");
        });
        uploadArea.addEventListener("dragleave", (e) => {
            e.preventDefault();
            uploadArea.classList.remove("dragover");
        });
        uploadArea.addEventListener("drop", (e) => {
            e.preventDefault();
            uploadArea.classList.remove("dragover");
            const files = e.dataTransfer.files;
            if (files.length > 0) handleFileSelect(files[0]);
        });
        fileInput.addEventListener("change", (e) => {
            if (e.target.files.length > 0) handleFileSelect(e.target.files[0]);
        });
        function handleFileSelect(file) {
            if (file && file.type.startsWith("image/")) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    previewImg.src = e.target.result;
                    imagePreview.classList.remove("d-none");
                    removeImageBtn.classList.remove("d-none");
                    imagePreview.style.opacity = "0";
                    setTimeout(() => {
                        imagePreview.style.transition = "opacity 0.3s ease";
                        imagePreview.style.opacity = "1";
                    }, 50);
                };
                reader.readAsDataURL(file);
            } else {
                if (previewImg) previewImg.src = "";
                if (imagePreview) imagePreview.classList.add("d-none");
                if (removeImageBtn) removeImageBtn.classList.add("d-none");
                if (fileInput) fileInput.value = "";
            }
        }
        removeImageBtn.addEventListener("click", function () {
            if (previewImg) previewImg.src = "";
            if (imagePreview) imagePreview.classList.add("d-none");
            this.classList.add("d-none");
            if (fileInput) fileInput.value = "";
        });
    }
    function validateFoodForm() {
        let valid = true;
        let name = document.getElementById('name');
        let price = document.getElementById('price');
        let size = document.getElementById('size');
        let imageFile = document.getElementById('imageFile');
        let errorMsg = '';
        if (!name.value.trim()) {
            errorMsg += 'Tên combo là bắt buộc!\n';
            name.classList.add('is-invalid');
            valid = false;
        } else {
            name.classList.remove('is-invalid');
        }
        if (!price.value || parseFloat(price.value) <= 0) {
            errorMsg += 'Giá phải lớn hơn 0!\n';
            price.classList.add('is-invalid');
            valid = false;
        } else {
            price.classList.remove('is-invalid');
        }
        if (!size.value || parseInt(size.value) <= 0) {
            errorMsg += 'Số lượng phải lớn hơn 0!\n';
            size.classList.add('is-invalid');
            valid = false;
        } else {
            size.classList.remove('is-invalid');
        }
        // Nếu là thêm mới, bắt buộc phải có ảnh
        if (!document.querySelector('img.img-thumbnail') && !imageFile.value) {
            errorMsg += 'Hình ảnh là bắt buộc!\n';
            imageFile.classList.add('is-invalid');
            valid = false;
        } else {
            imageFile.classList.remove('is-invalid');
        }
        if (!valid) {
            alert(errorMsg);
        }
        return valid;
    }
</script>
</body>
</html> 
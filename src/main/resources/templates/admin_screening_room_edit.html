<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org" >
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chỉnh sửa Phòng Chiếu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background: #f8fafc; }
        .edit-room-container { display: flex; gap: 32px; margin-top: 40px; }
        .seat-map-panel { flex: 1.5; background: #fff; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); padding: 32px; display: flex; flex-direction: column; align-items: center; }
        .seat-map-title { font-size: 20px; font-weight: 600; margin-bottom: 16px; }
        .seat-map { display: grid; gap: 8px; margin-bottom: 16px; }
        .seat { width: 32px; height: 32px; border-radius: 6px; border: 2px solid #ccc; display: flex; align-items: center; justify-content: center; font-size: 14px; cursor: pointer; transition: border 0.2s, background 0.2s; }
        .seat-standard { border-color: #22c55e; background: #f0fdf4; }
        .seat-vip { border-color: #ef4444; background: #fef2f2; }
        .seat-couple { border-color: #a21caf; background: #f3e8ff; }
        .seat-label { font-size: 12px; color: #64748b; margin-bottom: 8px; }
        .edit-form-panel { flex: 1; background: #fff; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); padding: 32px; }
        .form-title { font-size: 20px; font-weight: 600; margin-bottom: 16px; }
        .form-group { margin-bottom: 18px; }
        .form-label { font-weight: 500; margin-bottom: 6px; display: block; }
        .form-control, .form-select { border-radius: 6px; }
        .error-message { color: #ef4444; font-size: 14px; margin-bottom: 8px; }
        .seat-legend { display: flex; gap: 16px; margin-bottom: 16px; }
        .seat-legend-item { display: flex; align-items: center; gap: 6px; font-size: 13px; }
        .seat-legend .seat { width: 20px; height: 20px; }
        @media (max-width: 900px) {
            .edit-room-container { flex-direction: column; }
            .seat-map-panel, .edit-form-panel { width: 100%; }
        }
    </style>
</head>
<body>
<div class="container">
    <a th:href="@{/admin/screening-rooms/branch/{id}(id=${screeningRoom.branch.id})}" class="btn btn-link mt-4"><i class="fas fa-arrow-left"></i> Quay lại</a>
    <h2 class="mt-3 mb-2">Quản lý phòng Chiếu</h2>
    <div class="edit-room-container">
        <!-- Sơ đồ ghế động -->
        <div class="seat-map-panel">
            <div class="seat-map-title">Sơ đồ ghế</div>
            <div class="seat-label">
                <span id="seatMapInfo"></span>
            </div>
            <div class="seat-legend">
                <div class="seat-legend-item"><div class="seat seat-standard"></div> Standard</div>
                <div class="seat-legend-item"><div class="seat seat-vip"></div> VIP</div>
                <div class="seat-legend-item"><div class="seat seat-couple"></div> Couple</div>
            </div>
            <div id="seatMap" class="seat-map"></div>
        </div>
        <!-- Form chỉnh sửa -->
        <div class="edit-form-panel">
            <div class="form-title">Chỉnh sửa thông tin phòng chiếu</div>
            <form th:action="@{/admin/screening-rooms/edit/{id}(id=${screeningRoom.id})}" method="post" th:object="${screeningRoom}" onsubmit="return validateRowsAndSeats();">
                <input type="hidden" th:field="*{branch.id}" />
                <div class="form-group">
                    <label class="form-label">Tên phòng chiếu</label>
                    <input type="text" class="form-control" th:field="*{name}" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Chọn hàng ghế:</label>
                    <input type="number" class="form-control" id="rows" th:field="*{rows}" min="2" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Số ghế mỗi hàng:</label>
                    <input type="number" class="form-control" id="seatsPerRow" th:field="*{seatsPerRow}" min="2" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Số lượng ghế</label>
                    <input type="number" class="form-control" id="capacity" th:field="*{capacity}" readonly>
                </div>
                <div id="rowsSeatsError" class="error-message"></div>
                <div class="form-group">
                    <div class="form-label">*Mặc định kiểu: 25% ghế đầu là standard, 50% ghế sau là ghế vip, còn lại là couple</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Type:</label>
                    <div>
                        <label><input type="radio" th:field="*{type}" value="2D" required> 2D</label>
                        <label class="ms-3"><input type="radio" th:field="*{type}" value="3D"> 3D</label>
                        <label class="ms-3"><input type="radio" th:field="*{type}" value="4D"> 4D</label>
                        <label class="ms-3"><input type="radio" th:field="*{type}" value="5D"> 5D</label>
                        <label class="ms-3"><input type="radio" th:field="*{type}" value="IMAX"> IMAX</label>

                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Trạng thái:</label>
                    <select class="form-select" th:field="*{status}" required>
                        <option value="ACTIVE">Hoạt động</option>
                        <option value="INACTIVE">Không hoạt động</option>
                        <option value="MAINTENANCE">Bảo trì</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Chọn những tiện ích:</label>
                    <div>
                        <label><input type="checkbox"> Âm thanh vòm</label>
                        <label class="ms-3"><input type="checkbox"> Ghế ngả</label>
                        <label class="ms-3"><input type="checkbox"> Điều hòa</label>
                        <label class="ms-3"><input type="checkbox"> Mini Game</label>
                        <label class="ms-3"><input type="checkbox"> Gift</label>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Mô tả</label>
                    <textarea class="form-control" th:field="*{description}" rows="3"></textarea>
                </div>
                <div class="d-flex gap-2 mt-4">
                    <a th:href="@{/admin/screening-rooms/branch/{id}(id=${screeningRoom.branch.id})}" class="btn btn-secondary">Hủy</a>
                    <button type="submit" class="btn btn-primary">Lưu</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script src="https://kit.fontawesome.com/4e7f7e6e8b.js" crossorigin="anonymous"></script>
<script>
// Validate số hàng ghế và số ghế mỗi hàng
function validateRowsAndSeats() {
    const rows = parseInt(document.getElementById('rows').value, 10);
    const seats = parseInt(document.getElementById('seatsPerRow').value, 10);
    let error = '';
    if (rows !== seats) {
        error = 'Chỉ cho phép phòng vuông (AxA)';
    } else if (rows % 2 !== 0) {
        error = 'Số hàng và số ghế mỗi hàng phải là số chẵn';
    } else if ((rows / 2) % 2 !== 0) {
        error = 'Số hàng (và số ghế mỗi hàng) chia 2 phải là số chẵn (để chia ghế couple)';
    }
    document.getElementById('rowsSeatsError').innerText = error;
    renderSeatMap();
    return error === '';
}
document.getElementById('rows').addEventListener('input', validateRowsAndSeats);
document.getElementById('seatsPerRow').addEventListener('input', validateRowsAndSeats);

// Render sơ đồ ghế động
function renderSeatMap() {
    const rows = parseInt(document.getElementById('rows').value, 10);
    const seats = parseInt(document.getElementById('seatsPerRow').value, 10);
    const seatMap = document.getElementById('seatMap');
    seatMap.innerHTML = '';
    if (isNaN(rows) || isNaN(seats) || rows < 2 || seats < 2) return;
    seatMap.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
    seatMap.style.gridTemplateColumns = `repeat(${seats}, 1fr)`;

    // Quy tắc mới: standard ở đầu, vip ở giữa, couple ở cuối
    const standardRows = Math.floor(rows * 0.25);
    const coupleRows = Math.floor(rows * 0.25);
    const vipStart = standardRows;
    const vipEnd = rows - coupleRows;

    for (let r = 0; r < rows; r++) {
        for (let c = 0; c < seats; c++) {
            let seatType = '';
            if (r < standardRows) seatType = 'seat-standard';
            else if (r >= vipStart && r < vipEnd) seatType = 'seat-vip';
            else seatType = 'seat-couple';
            const seatDiv = document.createElement('div');
            seatDiv.className = 'seat ' + seatType;
            seatMap.appendChild(seatDiv);
        }
    }
    document.getElementById('seatMapInfo').innerText = `Chọn hàng ghế: ${rows}, Số ghế mỗi hàng: ${seats}`;
}

function updateCapacity() {
    const rows = parseInt(document.getElementById('rows').value, 10);
    const seats = parseInt(document.getElementById('seatsPerRow').value, 10);
    const capacityInput = document.getElementById('capacity');
    if (!isNaN(rows) && !isNaN(seats) && rows > 0 && seats > 0) {
        capacityInput.value = rows * seats;
    } else {
        capacityInput.value = '';
    }
}
document.getElementById('rows').addEventListener('input', updateCapacity);
document.getElementById('seatsPerRow').addEventListener('input', updateCapacity);
window.onload = function() {
    validateRowsAndSeats();
    updateCapacity();
};
</script>
</body>
</html> 